2025-10-31 10:39
Status: #idea
Tags:

# 1 一些知识
## 1.1 VIP
VIP（Virtual IP），即虚拟IP，它是临时绑定在物理网卡上的别名，如eth0:x ，x为0-255的任意数字，你可以在一块网卡上绑定多个别名。
在实际生产环境中，需要在DNS配置中把网站域名地址解析到这个VIP地址，由这个VIP对用户提供服务。这样做的好处就是当提供服务的服务器宕机以后，在接管的服务器上会直接自动配置上同样的VIP提供服务。如果是使用实体IP的话，来回迁移就难以做到。负载均衡也常用这个技术。

其实现原理主要是靠 TCP/IP 的 ARP 协议。因为IP地址只是一个逻辑地址，在以太网中 MAC 地址才是真正用来进行数据传输的物理地址，每台主机中都有一个 ARP 高速缓存，存储同一个网络内的 IP 地址与 MAC 地址的对应关系，以太网中的主机发送数据时会先从这个缓存中查询目标 IP 对应的 MAC 地址，会向这个 MAC 地址发送数据。操作系统会自动维护这个缓存。这就是整个实现的关键，比如下面这个 ARP 缓存示例：
```shell
(192.168.1.219) at 00:21:5A:DB:68:E8 [ether] on bond0
(192.168.1.217) at 00:21:5A:DB:68:E8 [ether] on bond0
(192.168.1.218) at 00:21:5A:DB:7F:C2 [ether] on bond0
```
其中，192.168.1.217、192.168.1.218 是两台真实的电脑，192.168.1.217 为对外提供数据库服务的主机，192.168.1.218 为热备的机器，192.168.1.219 为虚IP。注意219、217的 MAC 地址是相同的。
当 218 发现 217 宕机后会向网络发送一个 ARP 数据包，告诉所有主机 192.168.1.219 这个IP对应的MAC地址是 00:21:5A:DB:7F:C2，这样所有发送到 219 的数据包都会发送到 MAC 地址为 00:21:5A:DB:7F:C2 的机器，也就是 218 的机器。

Linux系统给网卡配置VIP的方法常见的有两种，即别名IP（alias ip）以及辅助IP（secondary ip address）。**注意：别名IP将被遗弃，用辅助IP替代**。

---
# 2 引用
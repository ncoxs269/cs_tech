2025-06-18 16:22
Status: #idea
Tags:

# 1 hertz路由原理
Hertz 框架的路由原理主要基于前缀树（Prefix Tree，也称Trie树）来实现高效的路由匹配。当接收到HTTP请求时，Hertz会根据请求的URL路径在树形结构中进行查找，找到最匹配的处理函数。
以下是Hertz路由原理的更详细解释：
1. 前缀树结构:
- Hertz使用前缀树来存储和管理路由。每个节点代表URL路径的一部分（例如，`/`，`users`，`posts`）。
- 从根节点开始，每个节点的子节点代表该节点路径的下一个可能的路径段。
- 通过这种结构，可以快速地查找匹配的路由，因为相同的URL前缀可以共享节点，减少了不必要的遍历。
2. 路由匹配过程:
- 当一个请求到达Hertz时，框架会提取请求的URL路径。
- 从前缀树的根节点开始，根据路径段逐层向下查找。
- 如果当前节点有匹配的子节点，则沿着该子节点继续查找；如果没有匹配的子节点，则表示没有找到匹配的路由。
- 如果找到一个与URL路径完全匹配的节点，则表示找到了匹配的路由，并执行相应的处理函数。
- 在匹配过程中，Hertz还会处理一些特殊情况，例如：
    - **尾部斜杠处理:** Hertz默认会自动处理尾部斜杠，根据路由定义自动重定向。
    - **参数路由:** 支持类似 `/users/:id` 这样的带参数的路由，在匹配时会提取参数值。﻿
3. 中间件:
- Hertz支持中间件机制，可以在请求到达路由处理函数之前或之后执行一些通用逻辑，例如权限验证、日志记录等。
- 中间件可以看作是添加到路由匹配过程中的额外处理步骤。

# 2 漏桶和令牌桶
## 2.1 漏桶
把请求比作是水，请求进来了就把请求先放进桶里，但是不处理，并以限定的速度出水，出水就相当于处理请求。当水来得过猛而出水不够快时就会导致水直接溢出，即拒绝服务。
漏桶算法可以很好的控制流量的访问速度，一旦超过该速度就拒绝服务。

## 2.2 令牌桶
令牌桶算法的原理是系统会以一个恒定的速度往桶里放入令牌，而如果请求需要被处理，则需要先从桶里获取一个令牌，当桶里没有令牌可取时，则拒绝服务。

## 2.3 区别
漏桶算法与令牌桶算法的区别在于，漏桶算法能够强行限制数据的传输速率，令牌桶算法能够在限制数据的平均传输速率的同时还允许某种程度的突发传输。

---
# 3 引用
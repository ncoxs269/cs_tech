2025-05-07 21:40
Status: #idea
Tags:


# 1 消息队列基础
## 1.1 什么是消息队列
消息队列就是存放消息的容器。
参与消息传递的双方称为 **生产者** 和 **消费者** ，生产者负责发送消息，消费者负责处理消息。

## 1.2 有什么用
1. 异步处理：消息发送后就返回结果，减少响应时间。之后系统消费消息。
2. 削峰/限流：将短时间高并发产生的消息存储在消息队列中，然后后端服务再慢慢根据自己的能力去消费这些消息，这样就避免直接把后端服务打垮掉。
3. 降低系统耦合性：下游去消息队列消费即可，不需要和其他系统有耦合。
4. 顺序保证
5. 延时/定时处理
6. 实现分布式事务

## 1.3 会带来哪些问题
- **系统可用性降低**： 系统可用性在某种程度上降低，你需要考虑MQ挂掉或其他异常情况
- **系统复杂性提高**：需要处理消息重复消费、丢失、乱序、积压等情况
- **数据一致性问题**：消费者未正确消费消息，会导致数据不一致的情况

## 1.4 性能指标
对消息队列进行性能测试的关键点包括：**消息吞吐量、延迟时间、系统资源占用、消息可靠性和容错能力**。
消息队列能够在单位时间内处理多少消息（消息吞吐量）；消息从发送者发出到接收者接受的时间（延迟时间）；在高负载情况下对CPU、内存等系统资源的占用情况；消息是否可以确保完整无误地传递、以及在遇到故障时系统的恢复能力和持续服务的能力（消息可靠性和容错能力）。

## 1.5 消息模型
### 1.5.1 队列模型
![[image-125.png]]
又叫点对点模型。一条消息只能被一个消费者使用，未被消费的消息在队列中保留直到被消费或超时。

### 1.5.2 主题模型
![[image-126.png]]
又叫发布订阅模型（Pub/Sub） ，使用**主题（Topic）** 作为消息通信载体，类似于**广播模式**。发布者发布一条消息，该消息通过主题传递给所有的订阅者。

## 1.6 选型

| 对比方向 | 概要                                                                                                        |
| ---- | --------------------------------------------------------------------------------------------------------- |
| 吞吐量  | 万级的 ActiveMQ 和 RabbitMQ 的吞吐量（ActiveMQ 的性能最差）要比十万级甚至是百万级的 RocketMQ 和 Kafka 低一个数量级。                         |
| 可用性  | 都可以实现高可用。ActiveMQ 和 RabbitMQ 都是基于主从架构实现高可用性。RocketMQ 基于分布式架构。 Kafka 也是分布式的，一个数据多个副本，少数机器宕机，不会丢失数据，不会导致不可用 |
| 时效性  | RabbitMQ 基于 Erlang 开发，所以并发能力很强，性能极其好，延时很低，达到微秒级，其他几个都是 ms 级。                                              |
| 功能支持 | Pulsar 的功能更全面，支持多租户、多种消费模式和持久性模式等功能，是下一代云原生分布式消息流平台。                                                      |
| 消息丢失 | ActiveMQ 和 RabbitMQ 丢失的可能性非常低， Kafka、RocketMQ 和 Pulsar 理论上可以做到 0 丢失。                                      |

## 1.7 RocketMQ


---
# 2 引用